<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  
  
  <title>
    文件实现——文件分配方式 |
    
    青稞
  </title>
  
    <link rel="shortcut icon" href="/favicon.ico">
    
  
<link rel="stylesheet" href="/css/style.css">

  
  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<script src="/js/pace.min.js"></script>

<meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="青稞" type="application/atom+xml">
</head>

<body>
  <main class="content">
    <section class="outer">
  <article id="post-文件实现——文件分配方式" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
      

<h1 class="article-title" itemprop="name">
  文件实现——文件分配方式
</h1>



    </header>
    

    
    <div class="article-meta">
      <a href="/2021/12/31/%E6%96%87%E4%BB%B6%E5%AE%9E%E7%8E%B0%E2%80%94%E2%80%94%E6%96%87%E4%BB%B6%E5%88%86%E9%85%8D%E6%96%B9%E5%BC%8F/" class="article-date">
  <time datetime="2021-12-31T07:26:27.000Z" itemprop="datePublished">2021-12-31</time>
</a>
      
    </div>
    

    
    
<div class="tocbot"></div>

    

    <div class="article-entry" itemprop="articleBody">
      
      
      
      <p>文件的实现其实就是研究文件的物理结构，即文件数据在物理存储设备上是如何分布和组织的。而文件的实现又分为两个方面：一是文件的分配方式，也就是对磁盘非空闲块的管理；二是文件存储空间管理，对磁盘空闲块的管理。</p>
<p>常用的磁盘空间分配有三种：连续分配、链接分配和索引分配。</p>
<h1 id="1-连续分配"><a href="#1-连续分配" class="headerlink" title="1. 连续分配"></a>1. 连续分配</h1><p>连续分配方法要求每个文件在磁盘上占有一组连续的块，如图所示，。磁盘地址定义了磁盘上的一个线性排序。这种排序使作业访问磁盘时需要的寻道数和寻道时间最小。</p>
<p><img src="https://raw.githubusercontent.com/PengZong888/tuchuang/main/img/image-20211231203004646.png" alt="image-20211231203004646"></p>
<p>文件的连续分配可以用第一块的磁盘地址和连续块的数量来定义。一个文件的目录条目包括开始块的地址和该文件所分配区域的长度。</p>
<p>连续分配支持顺序访问和直接访问。其优点是实现简单、存取速度快。</p>
<p>缺点是文件长度不易动态增加，因为一个文件末尾后的盘块可能已分配给其它文件，一旦需要增减，就需要大量移动盘块。此外，反复增删文件后会产生外部碎片，且很难确定一个文件需要的空间大小，因而只适用于长度固定的文件。</p>
<h1 id="2-链接分配"><a href="#2-链接分配" class="headerlink" title="2. 链接分配"></a>2. 链接分配</h1><p>链接分配采取离散分配的方式，消除了外部碎片，因此显著提高了磁盘空间的利用率；而且，当文件动态增长时，也能动态地再为它分配盘块。此外，对文件的增、删、改也非常方便。链接分配又分为隐式链接和显式链接。</p>
<h2 id="2-1-隐式链接"><a href="#2-1-隐式链接" class="headerlink" title="2.1 隐式链接"></a>2.1 隐式链接</h2><p>如图，每个文件对应一个磁盘块的链表；磁盘块分布在磁盘的任何地方，出最后一个磁盘块外，每个盘块都有指向下一个盘块的指针，这些指针对用户是透明的。目录包括文件的第一块指针和最后一块的指针。</p>
<p><img src="https://raw.githubusercontent.com/PengZong888/tuchuang/main/img/image-20211231203637822.png" alt="image-20211231203637822"></p>
<p>创建新文件时，目录中增加一个新条目。每个目录项都由一个指向文件首块的指针。该指针初始化为NULL以表示空文件，大小字段为0.写文件会通过空闲空间管理系统找到空闲块，将该块链接到文件的尾部，以便写入。该文件则通过块到块的指针顺序读块。</p>
<p>隐式链接分配的缺点是无法直接访问磁盘块，且盘块指针会消耗一定的存储空间。而且它的稳定性也是一个问题，系统在运行过程中由于软件或硬件错误导致链表中的指针丢失或损坏，会导致文件数据的丢失。</p>
<h2 id="2-2-显式链接"><a href="#2-2-显式链接" class="headerlink" title="2.2 显式链接"></a>2.2 显式链接</h2><p>显式链接是指把用于链接文件各物理块的指针，从每个物理块的块末尾中提取出来，显式地存放在内存的一张链表中。该表在整个磁盘中仅设置一张，称为<strong>文件分配表（File Allocation Table，FAT）</strong>。每个表项中存放对应块的下一块链接指针，即下一个盘块号。文件的第一个盘块号记录在目录中。</p>
<p><img src="https://raw.githubusercontent.com/PengZong888/tuchuang/main/img/image-20211231204343174.png" alt="image-20211231204343174"></p>
<p>如图，在这里我们用-1表示文件的最后一块，用-2表示这个磁盘块空闲。因此，FAT不仅记录了文件各块之间的先后链接关系，同时还标记了空闲的磁盘块，OS也可以通过FAT对文件存储空间进行管理。</p>
<p>FAT表在系统启动时就会被读入内存，因此查找FAT的过程是在内存中进行的，因此不仅显著地提高了检索速度，而且明显减少了访问磁盘的次数。</p>
<h1 id="3-索引分配"><a href="#3-索引分配" class="headerlink" title="3. 索引分配"></a>3. 索引分配</h1><p>链接分配虽然解决了连续分配的外部碎片和文件大小管理的问题，但是，链接分配不能有效支持直接访问（FAT除外）。索引分配则解决了这个问题，它把每个文件的所有的盘块号都集中放在一起构成<strong>索引块（表）</strong>，如图所示：</p>
<p><img src="https://raw.githubusercontent.com/PengZong888/tuchuang/main/img/image-20211231205558889.png" alt="image-20211231205558889"></p>
<p>每个文件都有其索引块，这是一个磁盘块地址的数组。索引块的第i个条目指向文件的第i个块。目录条目包括索引块的地址。</p>
<p>创建文件时，索引块的所有指针都设为空。首次写入第i块时，先从空闲空间中取得一个块，在将其地址写到索引块的第i个条目。索引分配支持直接访问，且没有外部碎片。其缺点是由于索引块的分配，增加了系统存储空间的开销。</p>
<p>索引块的大小是一个重要的问题，每个文件必须有一个索引块，因此索引块应尽可能小，但索引块太小就无法支持大文件。可以采用以下机制来处理这个问题。</p>
<ul>
<li><strong>链接方案</strong>。一个索引块通常为一个磁盘块，因此它本身能直接读写。为了处理大文件，可以将多个索引块链接起来。</li>
<li><strong>多层索引</strong>。多层索引使第一层索引块指向第二层的索引块，第二层索引块再指向文件块。这种方法根据最大文件大小的要求，可以继续到第三次或第四层。</li>
<li><strong>混合索引</strong>。将多种索引分配方式相结合的分配方式。例如，系统既采用直接地址，又采用单级索引分配方式和多级索引分配方式。</li>
</ul>
<h1 id="4-三种分配方式的比较"><a href="#4-三种分配方式的比较" class="headerlink" title="4. 三种分配方式的比较"></a>4. 三种分配方式的比较</h1><table>
<thead>
<tr>
<th></th>
<th>访问第n条记录</th>
<th>优点</th>
<th>缺点</th>
</tr>
</thead>
<tbody><tr>
<td>连续分配</td>
<td>需访问磁盘1次</td>
<td>顺序存储时速度快，文件定长时可根据文件起始地址及记录长度进行随机访问</td>
<td>文件存储要求连续的存储空间，会产生碎片，不利于文件的动态扩充</td>
</tr>
<tr>
<td>链接分配</td>
<td>需访问磁盘n次</td>
<td>可解决外存的碎片问题，提高外存空间的利用率，动态增长较方便</td>
<td>只能按照文件的指针链顺序访问，查找效率低，指针信息存放消耗外存空间</td>
</tr>
<tr>
<td>索引分配</td>
<td>m级需访问磁盘m + 1次</td>
<td>可以随机访问，文件易于增删</td>
<td>索引表增加存储空间的开销，索引表的查找策略对文件系统效率影响较大</td>
</tr>
</tbody></table>
<p>此外，访问文件需要两次访问外存——首先要读取索引块的内容，然后访问具体的磁盘块，因而降低了文件的存取速度。为解决这一问题，通常将文件的索引块读入内存的缓冲区中，以加快文件的访问速度。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/12/31/%E6%96%87%E4%BB%B6%E5%AE%9E%E7%8E%B0%E2%80%94%E2%80%94%E6%96%87%E4%BB%B6%E5%88%86%E9%85%8D%E6%96%B9%E5%BC%8F/" data-id="ckzb6dz46001vzwtw2cas009l" class="article-share-link">
        Share
      </a>
      
    </footer>

  </div>

  
  
<nav class="article-nav">
  
  <a href="/2021/12/31/%E6%96%87%E4%BB%B6%E5%AE%9E%E7%8E%B0%E2%80%94%E2%80%94%E6%96%87%E4%BB%B6%E5%AD%98%E5%82%A8%E7%A9%BA%E9%97%B4%E7%AE%A1%E7%90%86/" class="article-nav-link">
    <strong class="article-nav-caption">Newer</strong>
    <div class="article-nav-title">
      
      文件实现——文件存储空间管理
      
    </div>
  </a>
  
  
  <a href="/2021/12/30/%E7%BB%8F%E5%85%B8IPC%E9%97%AE%E9%A2%98/" class="article-nav-link">
    <strong class="article-nav-caption">Older</strong>
    <div class="article-nav-title">经典IPC问题</div>
  </a>
  
</nav>

  

  
  
  
  

</article>
</section>
    <footer class="footer">
  <div class="outer">
    <div class="float-right">
      <ul class="list-inline">
  
  <li><i class="fe fe-smile-alt"></i> <span id="busuanzi_value_site_uv"></span></li>
  
  <li><i class="fe fe-bookmark"></i> <span id="busuanzi_value_page_pv"></span></li>
  
</ul>
    </div>
    <ul class="list-inline">
      <li>青稞 &copy; 2022</li>
      
        <li>ZHWANGART</li>
      
      <li>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></li>
      <li>theme  <a target="_blank" rel="noopener" href="https://github.com/zhwangart/hexo-theme-ocean">Ocean</a></li>
    </ul>
  </div>
</footer>
  </main>
  <aside class="sidebar">
    <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/hexo.svg" alt="青稞"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">Home</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">Archives</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/gallery">Gallery</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/about">About</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link nav-item-search" title="Search">
        <i class="fe fe-search"></i>
        Search
      </a>
    </li>
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      <div class="totop" id="totop">
  <i class="fe fe-rocket"></i>
</div>
    </li>
    <li class="nav-item">
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="fe fe-feed"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
  </aside>
  
<script src="/js/jquery-2.0.3.min.js"></script>


<script src="/js/jquery.justifiedGallery.min.js"></script>


<script src="/js/lazyload.min.js"></script>


<script src="/js/busuanzi-2.3.pure.min.js"></script>



<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/copybtn.js"></script>





<script src="/js/tocbot.min.js"></script>

<script>
  // Tocbot_v4.7.0  http://tscanlin.github.io/tocbot/
  tocbot.init({
    tocSelector: '.tocbot',
    contentSelector: '.article-entry',
    headingSelector: 'h1, h2, h3, h4, h5, h6',
    hasInnerContainers: true,
    scrollSmooth: true,
    positionFixedSelector: '.tocbot',
    positionFixedClass: 'is-position-fixed',
    fixedSidebarOffset: 'auto',
  });
</script>



<script src="/js/ocean.js"></script>

</body>

</html>